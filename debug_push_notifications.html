<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: #fff; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #333; border-radius: 5px; }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
        .info { color: #2196F3; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .log { background: #2a2a2a; padding: 10px; border-radius: 3px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>ğŸ”” ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</h1>
    
    <div class="section">
        <h2>ğŸ“Š ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã®ç¢ºèª</h2>
        <button onclick="checkBrowserSupport()">ãƒ–ãƒ©ã‚¦ã‚¶ã‚µãƒãƒ¼ãƒˆã‚’ç¢ºèª</button>
        <div id="browserSupport" class="log"></div>
    </div>

    <div class="section">
        <h2>ğŸ” é€šçŸ¥è¨±å¯ã®ç¢ºèªãƒ»ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</h2>
        <button onclick="checkNotificationPermission()">é€šçŸ¥è¨±å¯ã‚’ç¢ºèª</button>
        <button onclick="requestNotificationPermission()">é€šçŸ¥è¨±å¯ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</button>
        <div id="notificationPermission" class="log"></div>
    </div>

    <div class="section">
        <h2>âš™ï¸ Service Workerã®ç¢ºèª</h2>
        <button onclick="checkServiceWorker()">Service Workerã‚’ç¢ºèª</button>
        <div id="serviceWorker" class="log"></div>
    </div>

    <div class="section">
        <h2>ğŸ§ª ãƒ†ã‚¹ãƒˆé€šçŸ¥ã®é€ä¿¡</h2>
        <button onclick="sendTestNotification()">ãƒ†ã‚¹ãƒˆé€šçŸ¥ã‚’é€ä¿¡</button>
        <button onclick="sendTestNotificationWithServiceWorker()">Service WorkerçµŒç”±ã§ãƒ†ã‚¹ãƒˆé€šçŸ¥</button>
        <div id="testNotification" class="log"></div>
    </div>

    <div class="section">
        <h2>ğŸ“¡ Supabaseæ¥ç¶šã®ç¢ºèª</h2>
        <button onclick="checkSupabaseConnection()">Supabaseæ¥ç¶šã‚’ç¢ºèª</button>
        <button onclick="testRealtimeSubscription()">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’ãƒ†ã‚¹ãƒˆ</button>
        <div id="supabaseConnection" class="log"></div>
    </div>

    <div class="section">
        <h2>ğŸ” é€šçŸ¥ã®æµã‚Œã‚’ãƒ‡ãƒãƒƒã‚°</h2>
        <button onclick="debugNotificationFlow()">é€šçŸ¥ã®æµã‚Œã‚’ãƒ‡ãƒãƒƒã‚°</button>
        <div id="notificationFlow" class="log"></div>
    </div>

    <script>
        // Supabaseè¨­å®š
        const SUPABASE_URL = 'https://mrjocjcppjnjxtudebta.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1yam9jamNwcGpuanh0dWRlYnRhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA4NTk5NDksImV4cCI6MjA3NjQzNTk0OX0.jflBtUsb7Qq4-p-e-XDUb1DoxHbwjG1DFXPXDC-sN2E';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info';
            element.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
        }

        function checkBrowserSupport() {
            const elementId = 'browserSupport';
            document.getElementById(elementId).innerHTML = '';
            
            log(elementId, 'ğŸ” ãƒ–ãƒ©ã‚¦ã‚¶ã‚µãƒãƒ¼ãƒˆã‚’ç¢ºèªä¸­...');
            
            // é€šçŸ¥APIã‚µãƒãƒ¼ãƒˆ
            if ('Notification' in window) {
                log(elementId, 'âœ… Notification API ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™', 'success');
                log(elementId, `ğŸ“± é€šçŸ¥è¨±å¯çŠ¶æ…‹: ${Notification.permission}`, 'info');
            } else {
                log(elementId, 'âŒ Notification API ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
            }

            // Service Workerã‚µãƒãƒ¼ãƒˆ
            if ('serviceWorker' in navigator) {
                log(elementId, 'âœ… Service Worker ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™', 'success');
            } else {
                log(elementId, 'âŒ Service Worker ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
            }

            // Push Managerã‚µãƒãƒ¼ãƒˆ
            if ('PushManager' in window) {
                log(elementId, 'âœ… PushManager ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™', 'success');
            } else {
                log(elementId, 'âŒ PushManager ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
            }

            // ã‚»ã‚­ãƒ¥ã‚¢ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
            if (window.isSecureContext) {
                log(elementId, 'âœ… ã‚»ã‚­ãƒ¥ã‚¢ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆHTTPSï¼‰ã§ã™', 'success');
            } else {
                log(elementId, 'âŒ ã‚»ã‚­ãƒ¥ã‚¢ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆHTTPï¼‰', 'error');
            }

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
            log(elementId, `ğŸ“± ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ: ${navigator.userAgent}`, 'info');
        }

        function checkNotificationPermission() {
            const elementId = 'notificationPermission';
            document.getElementById(elementId).innerHTML = '';
            
            log(elementId, 'ğŸ” é€šçŸ¥è¨±å¯çŠ¶æ³ã‚’ç¢ºèªä¸­...');
            
            if ('Notification' in window) {
                const permission = Notification.permission;
                log(elementId, `ğŸ“± ç¾åœ¨ã®è¨±å¯çŠ¶æ…‹: ${permission}`, 'info');
                
                switch(permission) {
                    case 'granted':
                        log(elementId, 'âœ… é€šçŸ¥ãŒè¨±å¯ã•ã‚Œã¦ã„ã¾ã™', 'success');
                        break;
                    case 'denied':
                        log(elementId, 'âŒ é€šçŸ¥ãŒæ‹’å¦ã•ã‚Œã¦ã„ã¾ã™', 'error');
                        log(elementId, 'ğŸ’¡ ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã§é€šçŸ¥ã‚’è¨±å¯ã—ã¦ãã ã•ã„', 'warning');
                        break;
                    case 'default':
                        log(elementId, 'âš ï¸ é€šçŸ¥è¨±å¯ãŒã¾ã ãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“', 'warning');
                        break;
                }
            } else {
                log(elementId, 'âŒ Notification API ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
            }
        }

        async function requestNotificationPermission() {
            const elementId = 'notificationPermission';
            document.getElementById(elementId).innerHTML = '';
            
            log(elementId, 'ğŸ”” é€šçŸ¥è¨±å¯ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¸­...');
            
            if ('Notification' in window) {
                try {
                    const permission = await Notification.requestPermission();
                    log(elementId, `ğŸ“± è¨±å¯çµæœ: ${permission}`, permission === 'granted' ? 'success' : 'error');
                    
                    if (permission === 'granted') {
                        log(elementId, 'âœ… é€šçŸ¥ãŒè¨±å¯ã•ã‚Œã¾ã—ãŸï¼', 'success');
                        // ãƒ†ã‚¹ãƒˆé€šçŸ¥ã‚’é€ä¿¡
                        showTestNotification('é€šçŸ¥è¨±å¯ãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'ã“ã‚Œã§ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ãŒå±Šãã¯ãšã§ã™ã€‚');
                    } else {
                        log(elementId, 'âŒ é€šçŸ¥ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ', 'error');
                    }
                } catch (error) {
                    log(elementId, `âŒ é€šçŸ¥è¨±å¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            } else {
                log(elementId, 'âŒ Notification API ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
            }
        }

        function showTestNotification(title, body) {
            if ('Notification' in window && Notification.permission === 'granted') {
                try {
                    const notification = new Notification(title, {
                        body: body,
                        icon: '/OEM/icon-192.svg',
                        badge: '/OEM/icon-192.svg',
                        tag: 'test-notification',
                        requireInteraction: true
                    });
                    
                    notification.onclick = function() {
                        console.log('é€šçŸ¥ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ');
                        notification.close();
                    };
                    
                    return notification;
                } catch (error) {
                    console.error('é€šçŸ¥ä½œæˆã‚¨ãƒ©ãƒ¼:', error);
                    return null;
                }
            }
            return null;
        }

        async function checkServiceWorker() {
            const elementId = 'serviceWorker';
            document.getElementById(elementId).innerHTML = '';
            
            log(elementId, 'ğŸ” Service Workerã‚’ç¢ºèªä¸­...');
            
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.ready;
                    log(elementId, 'âœ… Service Worker ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™', 'success');
                    log(elementId, `ğŸ“± ã‚¹ã‚³ãƒ¼ãƒ—: ${registration.scope}`, 'info');
                    
                    if (registration.active) {
                        log(elementId, 'âœ… Service Worker ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã§ã™', 'success');
                    } else {
                        log(elementId, 'âš ï¸ Service Worker ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã§ã¯ã‚ã‚Šã¾ã›ã‚“', 'warning');
                    }
                    
                    // ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç¢ºèª
                    if ('PushManager' in window) {
                        try {
                            const subscription = await registration.pushManager.getSubscription();
                            if (subscription) {
                                log(elementId, 'âœ… ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ã¾ã™', 'success');
                            } else {
                                log(elementId, 'âš ï¸ ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ã¾ã›ã‚“', 'warning');
                            }
                        } catch (error) {
                            log(elementId, `âš ï¸ ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®ç¢ºèªã§ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'warning');
                        }
                    }
                } catch (error) {
                    log(elementId, `âŒ Service Worker ã®ç¢ºèªã§ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            } else {
                log(elementId, 'âŒ Service Worker ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
            }
        }

        function sendTestNotification() {
            const elementId = 'testNotification';
            document.getElementById(elementId).innerHTML = '';
            
            log(elementId, 'ğŸ§ª ãƒ†ã‚¹ãƒˆé€šçŸ¥ã‚’é€ä¿¡ä¸­...');
            
            if ('Notification' in window && Notification.permission === 'granted') {
                const notification = showTestNotification(
                    'MARUGO OEM Special Menu',
                    'ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆé€šçŸ¥ã§ã™ã€‚ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ã€‚'
                );
                
                if (notification) {
                    log(elementId, 'âœ… ãƒ†ã‚¹ãƒˆé€šçŸ¥ã‚’é€ä¿¡ã—ã¾ã—ãŸ', 'success');
                } else {
                    log(elementId, 'âŒ ãƒ†ã‚¹ãƒˆé€šçŸ¥ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } else {
                log(elementId, 'âŒ é€šçŸ¥ãŒè¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
            }
        }

        async function sendTestNotificationWithServiceWorker() {
            const elementId = 'testNotification';
            document.getElementById(elementId).innerHTML = '';
            
            log(elementId, 'ğŸ§ª Service WorkerçµŒç”±ã§ãƒ†ã‚¹ãƒˆé€šçŸ¥ã‚’é€ä¿¡ä¸­...');
            
            try {
                const registration = await navigator.serviceWorker.ready;
                
                if (registration.active) {
                    // Service Workerã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
                    registration.active.postMessage({
                        type: 'SHOW_NOTIFICATION',
                        notificationData: {
                            title: 'MARUGO OEM Special Menu',
                            message: 'Service WorkerçµŒç”±ã®ãƒ†ã‚¹ãƒˆé€šçŸ¥ã§ã™',
                            icon: '/OEM/icon-192.svg',
                            badge: '/OEM/icon-192.svg',
                            tag: 'sw-test-notification',
                            url: '/OEM/',
                            notification_id: 'test-' + Date.now()
                        }
                    });
                    
                    log(elementId, 'âœ… Service Workerã«é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã—ãŸ', 'success');
                } else {
                    log(elementId, 'âŒ Service Worker ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã§ã¯ã‚ã‚Šã¾ã›ã‚“', 'error');
                }
            } catch (error) {
                log(elementId, `âŒ Service WorkerçµŒç”±ã®é€šçŸ¥é€ä¿¡ã§ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        async function checkSupabaseConnection() {
            const elementId = 'supabaseConnection';
            document.getElementById(elementId).innerHTML = '';
            
            log(elementId, 'ğŸ” Supabaseæ¥ç¶šã‚’ç¢ºèªä¸­...');
            
            try {
                // åŸºæœ¬çš„ãªæ¥ç¶šãƒ†ã‚¹ãƒˆ
                const { data, error } = await supabase
                    .from('notifications')
                    .select('id')
                    .limit(1);
                
                if (error) {
                    log(elementId, `âŒ Supabaseæ¥ç¶šã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                } else {
                    log(elementId, 'âœ… Supabaseæ¥ç¶šãŒæ­£å¸¸ã§ã™', 'success');
                }
                
                // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
                log(elementId, 'ğŸ“¡ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆä¸­...');
                
                const channel = supabase
                    .channel('debug-notifications')
                    .on('postgres_changes',
                        { event: 'INSERT', schema: 'public', table: 'notifications' },
                        (payload) => {
                            log(elementId, `ğŸ”” ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥ã‚’å—ä¿¡: ${JSON.stringify(payload)}`, 'success');
                        }
                    )
                    .subscribe((status) => {
                        log(elementId, `ğŸ“Š ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹: ${status}`, 'info');
                    });
                
                // 5ç§’å¾Œã«ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                setTimeout(() => {
                    channel.unsubscribe();
                    log(elementId, 'ğŸ§¹ ãƒ†ã‚¹ãƒˆç”¨ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã—ã¾ã—ãŸ', 'info');
                }, 5000);
                
            } catch (error) {
                log(elementId, `âŒ Supabaseæ¥ç¶šç¢ºèªã§ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        async function testRealtimeSubscription() {
            const elementId = 'supabaseConnection';
            document.getElementById(elementId).innerHTML = '';
            
            log(elementId, 'ğŸ“¡ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’ãƒ†ã‚¹ãƒˆä¸­...');
            
            try {
                // ãƒ†ã‚¹ãƒˆé€šçŸ¥ã‚’æŒ¿å…¥
                const { data, error } = await supabase
                    .from('notifications')
                    .insert([{
                        message: 'ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ†ã‚¹ãƒˆé€šçŸ¥',
                        type: 'debug',
                        created_by: null
                    }])
                    .select();
                
                if (error) {
                    log(elementId, `âŒ ãƒ†ã‚¹ãƒˆé€šçŸ¥ã®æŒ¿å…¥ã§ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                } else {
                    log(elementId, 'âœ… ãƒ†ã‚¹ãƒˆé€šçŸ¥ã‚’æŒ¿å…¥ã—ã¾ã—ãŸ', 'success');
                    log(elementId, `ğŸ“ æŒ¿å…¥ã•ã‚ŒãŸé€šçŸ¥: ${JSON.stringify(data)}`, 'info');
                }
                
            } catch (error) {
                log(elementId, `âŒ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ†ã‚¹ãƒˆã§ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        async function debugNotificationFlow() {
            const elementId = 'notificationFlow';
            document.getElementById(elementId).innerHTML = '';
            
            log(elementId, 'ğŸ” é€šçŸ¥ã®æµã‚Œã‚’ãƒ‡ãƒãƒƒã‚°ä¸­...');
            
            // 1. ãƒ–ãƒ©ã‚¦ã‚¶ã‚µãƒãƒ¼ãƒˆç¢ºèª
            log(elementId, '1ï¸âƒ£ ãƒ–ãƒ©ã‚¦ã‚¶ã‚µãƒãƒ¼ãƒˆç¢ºèª');
            if (!('Notification' in window)) {
                log(elementId, 'âŒ Notification API ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }
            if (!('serviceWorker' in navigator)) {
                log(elementId, 'âŒ Service Worker ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }
            log(elementId, 'âœ… ãƒ–ãƒ©ã‚¦ã‚¶ã‚µãƒãƒ¼ãƒˆOK', 'success');
            
            // 2. é€šçŸ¥è¨±å¯ç¢ºèª
            log(elementId, '2ï¸âƒ£ é€šçŸ¥è¨±å¯ç¢ºèª');
            if (Notification.permission !== 'granted') {
                log(elementId, `âŒ é€šçŸ¥ãŒè¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“: ${Notification.permission}`, 'error');
                return;
            }
            log(elementId, 'âœ… é€šçŸ¥è¨±å¯OK', 'success');
            
            // 3. Service Workerç¢ºèª
            log(elementId, '3ï¸âƒ£ Service Workerç¢ºèª');
            try {
                const registration = await navigator.serviceWorker.ready;
                if (!registration.active) {
                    log(elementId, 'âŒ Service Worker ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã§ã¯ã‚ã‚Šã¾ã›ã‚“', 'error');
                    return;
                }
                log(elementId, 'âœ… Service Worker OK', 'success');
            } catch (error) {
                log(elementId, `âŒ Service Worker ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                return;
            }
            
            // 4. Supabaseæ¥ç¶šç¢ºèª
            log(elementId, '4ï¸âƒ£ Supabaseæ¥ç¶šç¢ºèª');
            try {
                const { data, error } = await supabase
                    .from('notifications')
                    .select('id')
                    .limit(1);
                
                if (error) {
                    log(elementId, `âŒ Supabaseæ¥ç¶šã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                    return;
                }
                log(elementId, 'âœ… Supabaseæ¥ç¶šOK', 'success');
            } catch (error) {
                log(elementId, `âŒ Supabaseæ¥ç¶šã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                return;
            }
            
            // 5. ç·åˆåˆ¤å®š
            log(elementId, 'ğŸ¯ ç·åˆåˆ¤å®š');
            log(elementId, 'âœ… ã™ã¹ã¦ã®æ¡ä»¶ãŒæº€ãŸã•ã‚Œã¦ã„ã¾ã™', 'success');
            log(elementId, 'ğŸ’¡ ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ãŒå±Šã‹ãªã„å ´åˆã¯ã€ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„:', 'info');
            log(elementId, '   - ã‚¢ãƒ—ãƒªãŒãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã«ã„ã‚‹ã‹', 'info');
            log(elementId, '   - ãƒ–ãƒ©ã‚¦ã‚¶ã®é€šçŸ¥è¨­å®š', 'info');
            log(elementId, '   - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶š', 'info');
            log(elementId, '   - Service Workerã®çŠ¶æ…‹', 'info');
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•å®Ÿè¡Œ
        window.addEventListener('load', () => {
            checkBrowserSupport();
            checkNotificationPermission();
            checkServiceWorker();
        });
    </script>
</body>
</html>
